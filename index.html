<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recipe Costing GG ‚Äî Arrow Key Navigation + Serving Summary</title>
  <style>
    :root { --bg:#f7fafc; --card:#fff; --accent:#0ea5a4; }
    body { font-family:Inter,ui-sans-serif,system-ui; background:var(--bg); margin:0; color:#111827; }
    .wrap { max-width:980px; margin:28px auto; padding:20px; }
    .card { background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(15,23,42,0.06); }
    input, select, button { font-size:14px; padding:8px; border-radius:8px; border:1px solid #e5e7eb; }
    input[type=number] { width:90px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:8px; border-top:1px solid #eef2f7; }
    .btn { background:var(--accent); color:#fff; border:none; border-radius:8px; cursor:pointer; padding:6px 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Recipe Costing GG (Arrow Key Navigation)</h2>
      <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; align-items:center;">
        <input id="recipeName" placeholder="Recipe Name" />
        <label>Servings: <input id="servings" type="number" min="1" value="1" /></label>
        <label>Buffer %: <input id="buffer" type="number" min="0" step="0.1" value="5" /></label>
        <label>Markup %: <input id="markup" type="number" min="0" step="0.1" value="30" /></label>
        <label>Food Cost %: <input id="foodCostInput" type="number" min="0" step="0.1" value="35" /></label>
        <label>Desired Weight per Serving: <input id="desiredServingWeight" type="number" min="1" step="1" value="100" /> g</label>
      </div>

      <table id="table">
        <thead>
          <tr>
            <th>Ingredient</th>
            <th>Actual Weight</th>
            <th>Unit of Measure</th>
            <th>Unit Cost</th>
            <th>Desired Weight</th>
            <th>Desired Unit</th>
            <th>Cost/Serving</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button id="addRow" class="btn">+ Add Ingredient</button>

      <h3>Results</h3>
      <div id="results"></div>
      <div id="servingSummary" style="margin-top:12px; font-weight:bold;"></div>
    </div>
  </div>

  <script>
    const tbody=document.querySelector('tbody');
    const results=document.getElementById('results');
    const servingSummary=document.getElementById('servingSummary');
    const addRowBtn=document.getElementById('addRow');

    function addRow(data={}) {
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><input class="name" value="${data.name||''}"></td>
        <td><input type="number" class="pkgSize" value="${data.pkgSize||''}"></td>
        <td><select class="pkgUnit"><option>g</option><option>kg</option><option>ml</option><option>l</option><option>pcs</option></select></td>
        <td><input type="number" class="pkgCost" value="${data.pkgCost||''}"></td>
        <td><input type="number" class="useWeight" value="${data.useWeight||''}"></td>
        <td><select class="useUnit"><option>g</option><option>kg</option><option>ml</option><option>l</option><option>pcs</option></select></td>
        <td class="costServe">‚Ç±0.00</td>
        <td><button class="btn del">‚úï</button></td>`;
      tbody.appendChild(tr);

      const pkgUnitSel=tr.querySelector('.pkgUnit');
      const useUnitSel=tr.querySelector('.useUnit');
      pkgUnitSel.addEventListener('change',()=>{useUnitSel.value=pkgUnitSel.value; computeAll();});

      tr.querySelectorAll('input,select').forEach(input=>{
        input.addEventListener('input',computeAll);
        input.addEventListener('keydown',handleKeyNav);
      });

      tr.querySelector('.del').onclick=()=>{tr.remove();computeAll();};
      tr.querySelector('.name').focus();
    }

    function convertToGrams(val,unit){
      val=parseFloat(val)||0;
      if(unit==='kg'||unit==='l') return val*1000;
      return val;
    }

    function computeAll(){
      let total=0;
      const servings=parseFloat(document.getElementById('servings').value)||1;
      const desiredWeight=parseFloat(document.getElementById('desiredServingWeight').value)||1;

      let totalActualWeight=0;

      tbody.querySelectorAll('tr').forEach(tr=>{
        const pkgSize=convertToGrams(tr.querySelector('.pkgSize').value,tr.querySelector('.pkgUnit').value);
        const pkgCost=parseFloat(tr.querySelector('.pkgCost').value)||0;
        const useWeight=convertToGrams(tr.querySelector('.useWeight').value,tr.querySelector('.useUnit').value);
        const costPerGram=pkgSize>0?pkgCost/pkgSize:0;
        const costForUse=costPerGram*useWeight;
        const costPerServing = costForUse / servings;
        tr.querySelector('.costServe').textContent='‚Ç±'+costPerServing.toFixed(2);
        total+=costForUse;
        totalActualWeight+=useWeight;
      });

      const markup=parseFloat(document.getElementById('markup').value)||0;
      const bufferPct=parseFloat(document.getElementById('buffer').value)||0;
      const desiredFoodCost=parseFloat(document.getElementById('foodCostInput').value)||0;

      const costPerServingTotal=total/servings;
      const buffer=total*(bufferPct/100);
      const adjusted=total+buffer;
      const sellPriceFromMarkup=costPerServingTotal*(1+markup/100);
      const sellPriceFromFoodCost=desiredFoodCost>0?costPerServingTotal/(desiredFoodCost/100):sellPriceFromMarkup;
      const foodCost=(costPerServingTotal/sellPriceFromFoodCost)*100;

      // Results
      results.innerHTML=`
        <p>Total Cost: ‚Ç±${total.toFixed(2)}</p>
        <p>Buffer (${bufferPct}%): ‚Ç±${buffer.toFixed(2)}</p>
        <p>Adjusted Cost: ‚Ç±${adjusted.toFixed(2)}</p>
        <p>Cost per Serving: ‚Ç±${costPerServingTotal.toFixed(2)}</p>
        <p>Suggested Selling Price (Markup ${markup}%): ‚Ç±${sellPriceFromMarkup.toFixed(2)}</p>
        <p>Suggested Selling Price (Target Food Cost ${desiredFoodCost}%): ‚Ç±${sellPriceFromFoodCost.toFixed(2)}</p>
        <p>Food Cost %: ${foodCost.toFixed(1)}%</p>`;

      // Serving Summary
      const estimatedServings=Math.floor(totalActualWeight / desiredWeight);
      servingSummary.innerHTML=`üçû Estimated Yield (Servings/Pieces) based on actual ingredients: <b>${estimatedServings}</b>`;
    }

    function handleKeyNav(e){
      const cell = e.target.closest('td');
      if(!cell) return;
      const row = cell.parentElement;
      const table = row.parentElement;
      const rows = [...table.querySelectorAll('tr')];
      const cells = [...row.querySelectorAll('input,select')];
      const cellIndex = cells.indexOf(e.target);
      const rowIndex = rows.indexOf(row);

      if(e.key==='ArrowRight'){ e.preventDefault(); if(cellIndex+1<cells.length) cells[cellIndex+1].focus(); }
      else if(e.key==='ArrowLeft'){ e.preventDefault(); if(cellIndex>0) cells[cellIndex-1].focus(); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); if(rowIndex>0){ const upper = rows[rowIndex-1].querySelectorAll('input,select')[cellIndex]; if(upper) upper.focus(); } }
      else if(e.key==='ArrowDown'){ e.preventDefault(); if(rowIndex+1<rows.length){ const lower = rows[rowIndex+1].querySelectorAll('input,select')[cellIndex]; if(lower) lower.focus(); } }
    }

    addRowBtn.onclick=()=>{addRow();};
    ['servings','markup','buffer','foodCostInput','desiredServingWeight'].forEach(id=>{
      document.getElementById(id).addEventListener('input',computeAll);
      document.getElementById(id).addEventListener('change',computeAll);
    });
    addRow();
  </script>
</body>
</html>
